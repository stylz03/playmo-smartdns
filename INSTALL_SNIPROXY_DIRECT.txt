# Copy and paste this ENTIRE block into EC2 terminal

sudo apt-get update && sudo apt-get install -y build-essential libev-dev libpcre3-dev autotools-dev automake git && cd /tmp && rm -rf sniproxy && git clone --depth 1 https://github.com/dlundquist/sniproxy.git && cd sniproxy && timeout 60 ./autogen.sh && timeout 120 ./configure && echo "Starting compilation at $(date)..." && timeout 300 make && echo "Compilation complete at $(date)" && sudo make install && sudo useradd -r -s /bin/false sniproxy 2>/dev/null || true && sudo mkdir -p /etc/sniproxy && sudo tee /etc/sniproxy/sniproxy.conf > /dev/null <<'CONF'
user daemon
pidfile /var/run/sniproxy.pid
error_log { syslog daemon priority notice }
table { .netflix.com .disneyplus.com .hulu.com .nflxvideo.net .bamgrid.com .hbomax.com .max.com .peacocktv.com .paramountplus.com .paramount.com .espn.com .espnplus.com .primevideo.com .amazonvideo.com .tv.apple.com .sling.com .discoveryplus.com .tubi.tv .crackle.com .roku.com .tntdrama.com .tbs.com .flosports.tv .magellantv.com .aetv.com .directv.com .britbox.com .dazn.com .fubo.tv .philo.com .dishanywhere.com .xumo.tv .hgtv.com .amcplus.com .mgmplus.com }
listen 0.0.0.0:443 { proto tls table { .netflix.com .disneyplus.com .hulu.com .nflxvideo.net .bamgrid.com .hbomax.com .max.com .peacocktv.com .paramountplus.com .paramount.com .espn.com .espnplus.com .primevideo.com .amazonvideo.com .tv.apple.com .sling.com .discoveryplus.com .tubi.tv .crackle.com .roku.com .tntdrama.com .tbs.com .flosports.tv .magellantv.com .aetv.com .directv.com .britbox.com .dazn.com .fubo.tv .philo.com .dishanywhere.com .xumo.tv .hgtv.com .amcplus.com .mgmplus.com } }
listen 0.0.0.0:80 { proto http table { .netflix.com .disneyplus.com .hulu.com .nflxvideo.net .bamgrid.com .hbomax.com .max.com .peacocktv.com .paramountplus.com .paramount.com .espn.com .espnplus.com .primevideo.com .amazonvideo.com .tv.apple.com .sling.com .discoveryplus.com .tubi.tv .crackle.com .roku.com .tntdrama.com .tbs.com .flosports.tv .magellantv.com .aetv.com .directv.com .britbox.com .dazn.com .fubo.tv .philo.com .dishanywhere.com .xumo.tv .hgtv.com .amcplus.com .mgmplus.com } }
CONF
 && sudo tee /etc/systemd/system/sniproxy.service > /dev/null <<'SERVICE'
[Unit]
Description=SNI Proxy for SmartDNS
After=network.target
[Service]
Type=forking
User=sniproxy
ExecStart=/usr/sbin/sniproxy -c /etc/sniproxy/sniproxy.conf
ExecReload=/bin/kill -HUP $MAINPID
Restart=always
RestartSec=10
[Install]
WantedBy=multi-user.target
SERVICE
 && sudo systemctl daemon-reload && sudo systemctl enable sniproxy && sudo systemctl start sniproxy && echo "âœ… Installation complete!" && sleep 2 && sudo systemctl status sniproxy --no-pager -l | head -15

